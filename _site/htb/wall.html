<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
<title>Björn Kaidel - HTB - Wall</title>
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&family=Roboto+Mono&display=swap" rel="stylesheet">
<link type="text/css" rel="stylesheet" href="../assets/css/styles.css">
<link type="text/css" rel="stylesheet" href="../assets/css/noFloatToC.css" media="screen and (max-width: 1459px)">
<link type="text/css" rel="stylesheet" href="../assets/css/phone.css" media="screen and (max-width: 510px)">

<script src="../assets/javascript/script.js"></script>

<meta name="viewport" content="initial-scale=1">
<meta name="description" content="Website of Björn Kaidel - Computer Scientist">
<meta name="keywords" content="Björn Kaidel, Security, Cryptography, Computer Science">

<!-- ****** faviconit.com favicons ****** -->
<link rel="shortcut icon" href="../assets/favicon/favicon.ico">
<link rel="icon" sizes="16x16 32x32 64x64" href="../assets/favicon/favicon.ico">
<link rel="icon" type="image/png" sizes="196x196" href="../assets/favicon/favicon-192.png">
<link rel="icon" type="image/png" sizes="160x160" href="../assets/favicon/favicon-160.png">
<link rel="icon" type="image/png" sizes="96x96" href="../assets/favicon/favicon-96.png">
<link rel="icon" type="image/png" sizes="64x64" href="../assets/favicon/favicon-64.png">
<link rel="icon" type="image/png" sizes="32x32" href="../assets/favicon/favicon-32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../assets/favicon/favicon-16.png">
<link rel="apple-touch-icon" href="../assets/favicon/favicon-57.png">
<link rel="apple-touch-icon" sizes="114x114" href="../assets/favicon/favicon-114.png">
<link rel="apple-touch-icon" sizes="72x72" href="../assets/favicon/favicon-72.png">
<link rel="apple-touch-icon" sizes="144x144" href="../assets/favicon/favicon-144.png">
<link rel="apple-touch-icon" sizes="60x60" href="../assets/favicon/favicon-60.png">
<link rel="apple-touch-icon" sizes="120x120" href="../assets/favicon/favicon-120.png">
<link rel="apple-touch-icon" sizes="76x76" href="../assets/favicon/favicon-76.png">
<link rel="apple-touch-icon" sizes="152x152" href="../assets/favicon/favicon-152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../assets/favicon/favicon-180.png">
<meta name="msapplication-TileColor" content="#FFFFFF">
<meta name="msapplication-TileImage" content="../assets/favicon//favicon-144.png">
<meta name="msapplication-config" content="../assets/favicon//browserconfig.xml">
	<!-- ****** faviconit.com favicons ****** -->

<!-- Metatags for Facebook -->
<meta property="og:title" content="Björn Kaidel">
<meta property="og:url" content="https://bjoernkaidel.github.io">
<meta property="og:type" content="website">
<meta property="og:description" content="Website of Björn Kaidel">
<meta property="og:image" content="https:/bjoernkaidel.github.io/assets/favicon/favicon.png">

  </head>

  <body>
    <nav>
  <div class="mainNav">
    <a href="/" id="logo">Björn Kaidel</a>
    <ul>
        
          <li><a href="/" >Home</a></li>
        
          <li><a href="/about.html" >About</a></li>
        
          <li><a href="/tutorials.html" class="current">Tutorials</a></li>
        
    </ul>
  </div>
</nav>

    <div class="mainContent">
      <h1>HTB - Wall Write-Up</h1>

<h2>Table of Contents</h2>

<h6>Published on 23.04.2020</h6>

<ul class="htbToC">
  <li><a href="#summary">Summary</a></li>
  <li><a href="#enum">Enumeration</a></li>
  <li><a href="#foothold">Foothold</a></li>
  <li><a href="#user">Exploitation - User</a></li>
  <li><a href="#root">Exploitation - Root</a></li>
</ul>

<div id="htbToC-Float">
  <span>HTB - Wall</span>
  <ul>
    <li><a href="#summary" id="summaryFloat">Summary</a></li>
    <li><a href="#enum" id="enumFloat">Enumeration</a></li>
    <li><a href="#foothold" id="footholdFloat">Foothold</a></li>
    <li><a href="#user" id="userFloat">Exploitation - User</a></li>
    <li><a href="#root" id="rootFloat">Exploitation - Root</a></li>
  </ul>
</div>

<h2 id="summary">Summary</h2>

<img class="htbCard" src="../assets/htb/Wall/card.png" alt="wall.html Card">

<p>
  Wall is a <a href="https://www.hackthebox.eu" target="blank" rel="noopener noreferrer">Hack The Box</a> machine and has the IP address 10.10.10.157. It was released on the 14. September 2019, uses a <span class="htbTool">Linux</span> OS and is categorized as a <i>medium</i> machine.
</p>

<p>
  TODO
</p>

<h2 id="enum">Enumeration</h2>

<p>The first thing to do is to enumerate and gather information about the box. One of the most important tools is the port scanner <span class="htbTool">nmap</span>. I like to run it with the parameters <span class="htbTool">-T4 -A -p-</span> to get a thorough scan:</p>

<div class="htbImage"> <img src="../assets/htb/Wall/nmap.png" alt="Wall nmap "> <span>nmap -T4 -A -p- 10.10.10.162</span> </div>

<p>
  There are two ports open on Wall:
</p>

<table class="htbTwoColumn">
  <tr>
    <td>Port 22 - ssh:</td>
    <td>ssh is rarely a direct way to attack HTB boxes, so I ignore that for now.</td>
  </tr>
  <tr>
    <td>Port 80 – ssl/http?:</td>
    <td>It seems like there's an <span class="htbTool">Apache</span> webserver running here</td>
  </tr>
</table>

<h3>Port 80 – Apache webserver:</h3>

Checking out the webserver on port 80 reveals the default <span class="htbTool">Apache</span> page:

<div class="htbImage"> <img src="../assets/htb/Wall/port80.png" alt="Wall Website on port 80"> <span>The website serverd on port 80</span> </div>

<p>
  Surfing to some random page also tells us the version (2.4.29) of the <span class="htbTool">Apache</span> server:
</p>

<div class="htbImage"> <img src="../assets/htb/Wall/apacheversion.png" alt="Wall Apache version"> <span>Version of the Apache server</span> </div>

<p>
  Since there's only the default webpage available, I directly start <span class="htbTool">dirbuster</span> and it finds a few files and directories:
</p>

<div class="htbImage"> <img src="../assets/htb/Wall/dirbuster_settings.png" alt="Wall Dirbuster Settings"> <span>dirbuster settings</span> </div>

<div class="htbImage"> <img src="../assets/htb/Wall/dirbuster_results.png" alt="Wall Dirbuster Results"> <span>dirbuster results</span> </div>

<p>
  Checking out the <i>aa.php</i> and <i>panel.php</i> pages doesn't reveal anything interesting. The <i>/monitoring</i> directory reveals a login prompt, however:
</p>

<div class="htbImage"> <img src="../assets/htb/Wall/loginprompt.png" alt="Wall /monitoring Login Prompt"> <span>/monitoring login prompt</span> </div>

<p>
  Trying to brute force this login with <span class="htbTool">hydra</span> didn't get me anywhere, so I intercepted a login attempt with <span class="htbTool">Burpsuite</span> and changed the GET request to a POST request. This redirects me to the page <i>10.10.10.157/centroen</i>, which <span class="htbTool">dirbuster</span> unfortunately didn't find, because I apparently used a wordlist that did not contain the word <i>centroen</i>...
</p>

<div class="htbImage"> <img src="../assets/htb/Wall/centreon.png" alt="Wall Centreon Login page"> <span>Login page at 10.10.10.157/centreon</span> </div>

<p>
  There's an <a href="https://www.exploit-db.com/exploits/47069" target="blank" rel="noopener noreferrer">remote code execution exploit available at exploit-db</a> for this version of Centreon, but it unfortunately needs to be authenticated, so we first need to find a working username-password combination. Apparently, a standard user is <i>admin</i>.
</p>

<h2 id="foothold">Foothold</h2>

<h2 id="user">Exploitation - User</h2>

<p>
  Unfortunately, there's no <i>user.txt</i> in the home directory of <i>mango</i>, so it seems like we need to do some lateral movement to another user:
</p>

<div class="htbImage"> <img src="../assets/htb/Wall/mango_nousertxt.png" alt="Wall Home Directory of mango"> <span>Home directory of mango</span> </div>

<p>
  Checking out the <i>/home</i> directory reveals that there is not only a user called <i>admin</i> registered in the database, but also on the machine itself:
</p>

<div class="htbImage"> <img src="../assets/htb/Wall/boxusers.png" alt="Wall /home Directory"> <span>The /home directory</span> </div>

<p>
  I try to simply change to the user <i>admin</i> by using the <i>su</i> command and the password I found earlier... and it works! After the surprisingly complex foothold step, this was quite easy :)
</p>

<div class="htbImage"> <img src="../assets/htb/Wall/admin_usertxt.png" alt="Wall Admin user.txt"> <span>Reading the user.txt in /home/admin</span> </div>

<h2 id="root">Exploitation - Root</h2>

<p>
  To root the box, I first use my new privileges as the user <i>admin</i> and enumerate the box. While looking for <span class="htbTool">SUID</span> files with the command <i>find / -perm -u=s -type f 2>/dev/null</i>, I see that <i>admin</i> can execute <span class="htbTool">jjs</span> with root permissions.
</p>

<div class="htbImage"> <img src="../assets/htb/Wall/suid_jjs.png" alt="Wall SUID jjs"> <span>Checking for suid files</span> </div>

<p>
  <span class="htbTool">jjs</span> is a command-line tool that comes bundled with some releases of the Java Development Kit and allows for the execution of JavaScript code. <a href="https://gtfobins.github.io/gtfobins/jjs/" target="blank" rel="noopener noreferrer">GTFOBins</a> has a page on <span class="htbTool">jjs</span> with some suggestions on what could work to escalate our privileges.
</p>

<p>
  Unfortunately, simply spawning a shell doesn't work for me. However, I can use the suggested code for writing files to add my own <span class="htbTool">ssh</span> key to <i>root:</i>
</p>

<div class="htbImage"> <img src="../assets/htb/Wall/jjs_addkey.png" alt="Wall Adding own root ssh key using jjs"> <span>Adding own root ssh key using jjs</span> </div>

<p>
  I then simply connect to the box as <i>root</i> through <span class="htbTool">ssh</span> and I'm done!
</p>

<div class="htbImage"> <img src="../assets/htb/Wall/root.png" alt="Wall Root access"> <span>Success!</span> </div>

    </div>
  </body>
</html>
